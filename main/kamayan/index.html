
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://acreyes.github.io/kamayan/main/kamayan/">
      
      
        <link rel="prev" href="../api/">
      
      
        <link rel="next" href="../driver/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Kamayan - Kamayan</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#kamayan" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Kamayan" class="md-header__button md-logo" aria-label="Kamayan" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kamayan
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Kamayan
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/acreyes/kamayan" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Kamayan" class="md-nav__button md-logo" aria-label="Kamayan" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Kamayan
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/acreyes/kamayan" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Building
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Building
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../building/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build Instructions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../simulation_setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setting up a Simulation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Infrastructure
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Infrastructure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Kamayan
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Kamayan
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#config" class="md-nav__link">
    <span class="md-ellipsis">
      Config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#runtime-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Runtime Parameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kamayanunit" class="md-nav__link">
    <span class="md-ellipsis">
      KamayanUnit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unitcollection" class="md-nav__link">
    <span class="md-ellipsis">
      UnitCollection
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unitdata" class="md-nav__link">
    <span class="md-ellipsis">
      UnitData
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../driver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Driver
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../grid/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Grid
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dispatcher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dispatcher
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../type_list/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TypeList
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Physics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Physics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../physics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Physics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hydro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hydro Unit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../eos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Equation Of State Unit
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#config" class="md-nav__link">
    <span class="md-ellipsis">
      Config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#runtime-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Runtime Parameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kamayanunit" class="md-nav__link">
    <span class="md-ellipsis">
      KamayanUnit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unitcollection" class="md-nav__link">
    <span class="md-ellipsis">
      UnitCollection
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unitdata" class="md-nav__link">
    <span class="md-ellipsis">
      UnitData
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="kamayan">Kamayan</h1>
<p>This document describes the core infrastructure of Kamayan, focusing on the C++ implementation. 
For Python API documentation, see the <a href="../api/">API Reference</a>.</p>
<h2 id="config"><code>Config</code></h2>
<p>Kamayan tracks a global configuration that is made up of kamayan runtime
options that are compatible with the <a href="../dispatcher/">dispatcher</a>.
The <code>Config</code> wraps parthenon's <code>Params</code> class, but only holds kamayan
<code>POLYMORPHIC_PARM</code> <code>enum class</code>s, and only allows a single param
of each type in the <code>Config</code>. Kamayan provides an API for checking out
the global <code>Config</code> from the corresponding <code>StateDescriptor</code> with the
<code>GetConfig</code> interface.</p>
<h2 id="runtime-parameters">Runtime Parameters</h2>
<p>Parthenon provides a method for <a href="https://parthenon-hpc-lab.github.io/parthenon/develop/src/inputs.html">parameter input</a>,
that can be set with an input file as well as from the command line.
Kamayan wraps this system with the <code>RuntimeParameters</code> class. The
primary reason for doing this is to provide optionally defined constraints
for validating parameters on read, as well as to store doc strings
for runtime parameters at the location that they are defined. This
enables kamayan to generate parameter documentation for each unit
directly from the source code, and enforcing ownership of parameters
to their respective <code>KamayanUnit</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Kamayan provides another wrapper, through <code>UnitData</code>, around input parameters, parthenon package <code>params</code>, and the kamayan <a href="#config"><code>Config</code></a> that integrates seamlessly with the 
<a href="#kamayanunit"><code>KamayanUnit</code></a>s described later. This is the preferred
method for setting/adding runtime parameters when using <code>pyKamayan</code>.</p>
</div>
<p>The minimum required for a runtime parameter to be defined is a block name,
a parm name, default value, and a doc string.</p>
<div class="highlight"><span class="filename">problems/isentropic_vortex.cpp:parms</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">AddData</span><span class="p">(</span><span class="s">&quot;isentropic_vortex&quot;</span><span class="p">);</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="n">iv</span><span class="p">.</span><span class="n">AddParm</span><span class="o">&lt;</span><span class="n">Real</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;density&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Ambient density&quot;</span><span class="p">);</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">  </span><span class="n">iv</span><span class="p">.</span><span class="n">AddParm</span><span class="o">&lt;</span><span class="n">Real</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;pressure&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Ambient pressure&quot;</span><span class="p">);</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="n">iv</span><span class="p">.</span><span class="n">AddParm</span><span class="o">&lt;</span><span class="n">Real</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;velx&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Ambient x-velcoty&quot;</span><span class="p">);</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">  </span><span class="n">iv</span><span class="p">.</span><span class="n">AddParm</span><span class="o">&lt;</span><span class="n">Real</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;vely&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Ambient y-velcoty&quot;</span><span class="p">);</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">  </span><span class="n">iv</span><span class="p">.</span><span class="n">AddParm</span><span class="o">&lt;</span><span class="n">Real</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;strength&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">5.0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Vortex strength.&quot;</span><span class="p">);</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">  </span><span class="n">iv</span><span class="p">.</span><span class="n">AddParm</span><span class="o">&lt;</span><span class="n">Real</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;mhd_strength&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Vortex mhd_strength.&quot;</span><span class="p">);</span>
</code></pre></div>
<p>The parms then can be set in the input file under the corresponding <code>&lt;block_name&gt;</code> 
section
<div class="highlight"><span class="filename">problems/isentropic_vortex.in:parms</span><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>&lt;isentropic_vortex&gt;
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>density = 1.0
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>pressure = 1.0
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>velx = 1.0
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>vely = 1.0
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>strength = 5.0
</code></pre></div></p>
<p>Lastly kamayan supports some simple rules that can be used for validating
values read in from the input file using an initializer list.</p>
<ul>
<li><code>std::string</code> parameters can add a list of allowed values
<div class="highlight"><span class="filename">kamayan/tests/test_runtime_parameters.cpp:string</span><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="w">        </span><span class="n">runtime_parameters</span><span class="p">.</span><span class="n">Add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">            </span><span class="s">&quot;block2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;var6&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;This is block2/var5 string&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;world&quot;</span><span class="p">});</span>
</code></pre></div></li>
<li><code>int</code> &amp; <code>Real</code> parameters can be either allowed values or allowed ranges specified
by inclusive bounds
<div class="highlight"><span class="filename">kamayan/tests/test_runtime_parameters.cpp:int</span><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="w">    </span><span class="c1">// var4 == 8 or 3 &lt;= var4 &lt;= 6</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="n">runtime_parameters</span><span class="p">.</span><span class="n">Add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;block2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;var4&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;This is block2/var4 int&quot;</span><span class="p">,</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">                                </span><span class="p">{</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">}});</span>
</code></pre></div></li>
</ul>
<h2 id="kamayanunit"><code>KamayanUnit</code></h2>
<p>The <code>KamayanUnit</code> is the building block of a kamayan simulation, providing the 
interface into the initialization and driver evolution cycle through the
defined callbacks.</p>
<div class="highlight"><span class="filename">kamayan/unit.hpp:unit</span><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">KamayanUnit</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">StateDescriptor</span><span class="p">,</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">                     </span><span class="k">public</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">enable_shared_from_this</span><span class="o">&lt;</span><span class="n">KamayanUnit</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span><span class="k">explicit</span><span class="w"> </span><span class="n">KamayanUnit</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">StateDescriptor</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="w"> </span><span class="n">name_</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span><span class="o">~</span><span class="n">KamayanUnit</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">  </span><span class="c1">// Setup is called to add options into the kamayan configuration and to register</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">  </span><span class="c1">// runtime parameters owned by the unit</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">  </span><span class="n">CallbackRegistration</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="n">KamayanUnit</span><span class="w"> </span><span class="o">*</span><span class="n">unit</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">SetupParams</span><span class="p">;</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">  </span><span class="c1">// Initialize is responsible for setting up the parthenon StateDescriptor, registering</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">  </span><span class="c1">// params , adding fields owned by the unit &amp; registering any callbacks known to</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">  </span><span class="c1">// parthenon</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">  </span><span class="n">CallbackRegistration</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="n">KamayanUnit</span><span class="w"> </span><span class="o">*</span><span class="n">unit</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">InitializeData</span><span class="p">;</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">  </span><span class="c1">// Used as a callback during problem generation on the mesh</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">  </span><span class="n">CallbackRegistration</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="n">MeshBlock</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ProblemGeneratorMeshBlock</span><span class="p">;</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">  </span><span class="c1">// makes sure the conserved variables are ready before applying dudt</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">  </span><span class="n">CallbackRegistration</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">TaskStatus</span><span class="p">(</span><span class="n">MeshData</span><span class="w"> </span><span class="o">*</span><span class="n">md</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">PrepareConserved</span><span class="p">;</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">  </span><span class="c1">// make sure primitive variables are ready after updating conserved</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">  </span><span class="n">CallbackRegistration</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">TaskStatus</span><span class="p">(</span><span class="n">MeshData</span><span class="w"> </span><span class="o">*</span><span class="n">md</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">PreparePrimitive</span><span class="p">;</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="w">  </span><span class="c1">// Accumulates the fluxes in md, and the driver will handle the flux</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="w">  </span><span class="c1">// correction and dudt</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="w">  </span><span class="n">CallbackRegistration</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">TaskID</span><span class="p">(</span><span class="n">TaskID</span><span class="w"> </span><span class="n">prev</span><span class="p">,</span><span class="w"> </span><span class="n">TaskList</span><span class="w"> </span><span class="o">&amp;</span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">MeshData</span><span class="w"> </span><span class="o">*</span><span class="n">md</span><span class="p">)</span><span class="o">&gt;&gt;</span>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="w">      </span><span class="n">AddFluxTasks</span><span class="p">;</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="w">  </span><span class="c1">// These tasks get added to the tasklist that accumulate dudt for this unit based</span>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="w">  </span><span class="c1">// on the current state in md, returning the TaskID of the final task for a single</span>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="w">  </span><span class="c1">// stage in the multi-stage driver</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="w">  </span><span class="n">CallbackRegistration</span><span class="o">&lt;</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">TaskID</span><span class="p">(</span><span class="n">TaskID</span><span class="w"> </span><span class="n">prev</span><span class="p">,</span><span class="w"> </span><span class="n">TaskList</span><span class="w"> </span><span class="o">&amp;</span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">MeshData</span><span class="w"> </span><span class="o">*</span><span class="n">md</span><span class="p">,</span><span class="w"> </span><span class="n">MeshData</span><span class="w"> </span><span class="o">*</span><span class="n">dudt</span><span class="p">)</span><span class="o">&gt;&gt;</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="w">      </span><span class="n">AddTasksOneStep</span><span class="p">;</span>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="w">  </span><span class="c1">// These tasks are used to advance md by dt as one of the operators in the</span>
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a><span class="w">  </span><span class="c1">// operator splitting</span>
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="w">  </span><span class="n">CallbackRegistration</span><span class="o">&lt;</span>
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">TaskID</span><span class="p">(</span><span class="n">TaskID</span><span class="w"> </span><span class="n">prev</span><span class="p">,</span><span class="w"> </span><span class="n">TaskList</span><span class="w"> </span><span class="o">&amp;</span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">MeshData</span><span class="w"> </span><span class="o">*</span><span class="n">md</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Real</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dt</span><span class="p">)</span><span class="o">&gt;&gt;</span>
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a><span class="w">      </span><span class="n">AddTasksSplit</span><span class="p">;</span>
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a>
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">name_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a>
<a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a><span class="w">  </span><span class="c1">// get a reference to the UnitData configured for a particular block</span>
<a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">UnitData</span><span class="w"> </span><span class="o">&amp;</span><span class="nf">Data</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a><span class="w">  </span><span class="n">UnitData</span><span class="w"> </span><span class="o">&amp;</span><span class="nf">AddData</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">block</span><span class="p">);</span>
<a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="nf">HasData</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">AllData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">unit_data_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a>
<a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Config</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Configuration</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">config_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">runtime_parameters</span><span class="o">::</span><span class="n">RuntimeParameters</span><span class="o">&gt;</span><span class="w"> </span><span class="n">RuntimeParameters</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">runtime_parameters_</span><span class="p">;</span>
<a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a>
<a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">InitResources</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">runtime_parameters</span><span class="o">::</span><span class="n">RuntimeParameters</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rps</span><span class="p">,</span>
<a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a><span class="w">                     </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Config</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cfg</span><span class="p">);</span>
<a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">InitializePackage</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">StateDescriptor</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pkg</span><span class="p">);</span>
<a id="__codelineno-4-59" name="__codelineno-4-59" href="#__codelineno-4-59"></a>
<a id="__codelineno-4-60" name="__codelineno-4-60" href="#__codelineno-4-60"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetUnits</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">UnitCollection</span><span class="o">&gt;</span><span class="w"> </span><span class="n">units</span><span class="p">);</span>
<a id="__codelineno-4-61" name="__codelineno-4-61" href="#__codelineno-4-61"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">KamayanUnit</span><span class="w"> </span><span class="o">&amp;</span><span class="nf">GetUnit</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<a id="__codelineno-4-62" name="__codelineno-4-62" href="#__codelineno-4-62"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">KamayanUnit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetUnitPtr</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<a id="__codelineno-4-63" name="__codelineno-4-63" href="#__codelineno-4-63"></a>
<a id="__codelineno-4-64" name="__codelineno-4-64" href="#__codelineno-4-64"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">KamayanUnit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetFromMesh</span><span class="p">(</span><span class="n">MeshData</span><span class="w"> </span><span class="o">*</span><span class="n">md</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-4-65" name="__codelineno-4-65" href="#__codelineno-4-65"></a>
<a id="__codelineno-4-66" name="__codelineno-4-66" href="#__codelineno-4-66"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-4-67" name="__codelineno-4-67" href="#__codelineno-4-67"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name_</span><span class="p">;</span>
<a id="__codelineno-4-68" name="__codelineno-4-68" href="#__codelineno-4-68"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">UnitData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">unit_data_</span><span class="p">;</span>
<a id="__codelineno-4-69" name="__codelineno-4-69" href="#__codelineno-4-69"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Config</span><span class="o">&gt;</span><span class="w"> </span><span class="n">config_</span><span class="p">;</span>
<a id="__codelineno-4-70" name="__codelineno-4-70" href="#__codelineno-4-70"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">runtime_parameters</span><span class="o">::</span><span class="n">RuntimeParameters</span><span class="o">&gt;</span><span class="w"> </span><span class="n">runtime_parameters_</span><span class="p">;</span>
<a id="__codelineno-4-71" name="__codelineno-4-71" href="#__codelineno-4-71"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">weak_ptr</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">UnitCollection</span><span class="o">&gt;</span><span class="w"> </span><span class="n">units_</span><span class="p">;</span>
<a id="__codelineno-4-72" name="__codelineno-4-72" href="#__codelineno-4-72"></a><span class="p">};</span>
</code></pre></div>
<ul>
<li><code>SetupParams</code> -- Used to register runtime parameters to the simulation, and set options
used in the global <code>Config</code>. These are added through the <a href="#unitdata"><code>UnitData</code></a> interface.</li>
<li><code>InitializeData</code> -- Main place to initialize the underlying <code>parthenon::StateDescriptor</code> that <code>KamayanUnit</code>s inherit from. To register parthenon callbacks, 
add fields to be allocated on the mesh blocks and add data structures to the <code>Params</code>.</li>
<li><code>ProblemGeneratorMeshBlock</code> -- Called during mesh initialization to set the
initial conditions on a single <code>MeshBlock</code>.</li>
<li><code>PrepareConserved</code> -- Called before starting the evolution cycle to ensure
conserved variables are properly initialized, if not done so by the problem
generator.</li>
<li><code>PreparePrimitive</code> -- called at the end of an RK-stage, after applying <code>DuDt</code>
to convert from the updated conservative variables to primitives. Equation
of state should always be called last.</li>
<li>The following control how the mesh data is evolved. See <a href="../driver/">driver</a> for
more detail on how these are used.</li>
<li><code>AddFluxTasks</code></li>
<li><code>AddTasksOneStep</code></li>
<li><code>AddTasksSplit</code></li>
</ul>
<h2 id="unitcollection"><code>UnitCollection</code></h2>
<p><code>KamayanUnit</code>s are composed together into a <code>UnitCollection</code>, which is used 
to construct a <code>KamayanDriver</code>. In some case it could be desirable to 
express the order that some of the <code>KamayanUnit</code> callbacks get executed,
in which case there are some named <code>std::list&lt;std::string&gt;</code>s that will set
the execution order for some or all of their corresponding callbacks. Those
that are listed will be called last and in order using the <code>UnitCollection::AddTasks</code>
method.</p>
<h2 id="unitdata"><code>UnitData</code></h2>
<p>There is a natural relationship between input parameters and <code>StateDescriptor</code> <a href="https://parthenon-hpc-lab.github.io/parthenon/develop/src/interface/state.html#statedescriptor">params</a>, and <code>Config</code> options, that all have different entrypoints in terms of data structures (<code>RuntimeParameters</code>, <code>Config</code> and <code>StateDescriptor</code>).
The registering of variables and <code>PolyOpt&lt;T&gt;</code>s to these are commonly handled in the <code>Setup</code> &amp; <code>Init</code> <code>KamayanUnit</code> callbacks, and so kamayan provides <code>UnitData</code> to handle the registering and mapping between the three.</p>
<p>A <code>UnitData</code> object manages all of the parameters inside of a given input block. Depending on the template type passed to the <code>AddParm</code> method,
these will either get mapped to the owning unit's <code>StateDescriptor::Params</code>, or to the global kamayan <code>Config</code> object. </p>
<div class="highlight"><span class="filename">physics/hydro/hydro.cpp:add_parm</span><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="w">  </span><span class="c1">// since EMFAveraging was declared with the POLYMORPHIC_PARM macro</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="c1">// this will get mapped to the Config</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="n">hydro_data</span><span class="p">.</span><span class="n">AddParm</span><span class="o">&lt;</span><span class="n">EMFAveraging</span><span class="o">&gt;</span><span class="p">(</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">      </span><span class="s">&quot;EMF_averaging&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;arithmetic&quot;</span><span class="p">,</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">      </span><span class="s">&quot;Method to use for averaging the Face fluxes to edge electric field&quot;</span><span class="p">,</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">      </span><span class="p">{{</span><span class="s">&quot;arithmetic&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">EMFAveraging</span><span class="o">::</span><span class="n">arithmetic</span><span class="p">}});</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">  </span><span class="c1">// runtime parameter type (Real, int, string, bool) get mapped to the Params</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">  </span><span class="n">hydro_data</span><span class="p">.</span><span class="n">AddParm</span><span class="o">&lt;</span><span class="n">Real</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;cfl&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CFL stability number use in hydro&quot;</span><span class="p">);</span>
</code></pre></div>
<div class="highlight"><span class="filename">physics/hydro/hydro_time_step.cpp:get_param</span><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="w">    </span><span class="c1">// pull out params from owning unit with full input parameter block + key</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">hydro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">md</span><span class="o">-&gt;</span><span class="n">GetMeshPointer</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">packages</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="s">&quot;hydro&quot;</span><span class="p">);</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">cfl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hydro</span><span class="o">-&gt;</span><span class="n">Param</span><span class="o">&lt;</span><span class="n">Real</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;hydro/cfl&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Real</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ndim</span><span class="p">);</span>
</code></pre></div>
<p>Additionally params can be registered with <code>UnitData::Mutability</code> flag, which
defaults to <code>Immutable</code>, meaning that once the simulation has initialized
those parms should not be changed. If they are registered as immutable,
if the registered parameter is updated with <code>UnitData::UpdateParm</code> then
the parameter is updated both in the underlying package <code>Params</code> as well
as the runtime parameters.</p>
<p>All of the input blocks described by individual <code>UnitData</code> objects are owned
by their respective <code>KamayanUnit</code>s and made accessible during each unit's <code>Initialize</code>. 
The separation between <code>Setup</code> and <code>Initialize</code> is then in registering
<code>UnitData</code> parameters, and resolving the <code>Config</code> options first across all units, making them accessible to the initialization of each unit.</p>
<p>Parameters are uniquely owned by their respective <code>KamayanUnit</code>s, and the preferred 
way to access parameters from other units is directly through the unit's parameter 
interface using <code>unit-&gt;GetUnit(name)</code> to retrieve the desired unit, and then accessing 
its <code>UnitData</code> block.</p>
<div class="highlight"><span class="filename">problems/sedov.cpp:access_grid_params</span><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">grid_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">GetUnit</span><span class="p">(</span><span class="s">&quot;grid&quot;</span><span class="p">);</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nlevels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid_unit</span><span class="p">.</span><span class="n">Data</span><span class="p">(</span><span class="s">&quot;parthenon/mesh&quot;</span><span class="p">).</span><span class="n">Get</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;numlevel&quot;</span><span class="p">);</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid_unit</span><span class="p">.</span><span class="n">Data</span><span class="p">(</span><span class="s">&quot;parthenon/mesh&quot;</span><span class="p">).</span><span class="n">Get</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;nx1&quot;</span><span class="p">);</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">Real</span><span class="w"> </span><span class="n">xmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid_unit</span><span class="p">.</span><span class="n">Data</span><span class="p">(</span><span class="s">&quot;parthenon/mesh&quot;</span><span class="p">).</span><span class="n">Get</span><span class="o">&lt;</span><span class="n">Real</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x1min&quot;</span><span class="p">);</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">Real</span><span class="w"> </span><span class="n">xmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid_unit</span><span class="p">.</span><span class="n">Data</span><span class="p">(</span><span class="s">&quot;parthenon/mesh&quot;</span><span class="p">).</span><span class="n">Get</span><span class="o">&lt;</span><span class="n">Real</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x1max&quot;</span><span class="p">);</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">Real</span><span class="w"> </span><span class="n">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">xmax</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">xmin</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">nlevels</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Real</span><span class="o">&gt;</span><span class="p">(</span><span class="n">nx</span><span class="p">));</span>
</code></pre></div>
<p>This pattern allows units to access configuration from other units during initialization,
maintaining clear ownership while enabling cross-unit parameter dependencies.</p>
<p>Bindings to <code>UnitData</code> are provided through <code>pyKamayan</code>, and the <code>KamayanManager</code>
allows for type validation in setting input parameters and python object based setting.</p>
<div class="highlight"><span class="filename">problems/sedov.py:py_add_parms</span><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>    <span class="c1"># add a new input parameter block</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    <span class="n">sedov</span> <span class="o">=</span> <span class="n">unit</span><span class="o">.</span><span class="n">AddData</span><span class="p">(</span><span class="s2">&quot;sedov&quot;</span><span class="p">)</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    <span class="c1"># add Real runtime parameters</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    <span class="n">sedov</span><span class="o">.</span><span class="n">AddParm</span><span class="p">(</span><span class="s2">&quot;density&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;ambient density&quot;</span><span class="p">)</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    <span class="n">sedov</span><span class="o">.</span><span class="n">AddParm</span><span class="p">(</span><span class="s2">&quot;pressure&quot;</span><span class="p">,</span> <span class="mf">1.0e-5</span><span class="p">,</span> <span class="s2">&quot;ambient pressure&quot;</span><span class="p">)</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    <span class="n">sedov</span><span class="o">.</span><span class="n">AddParm</span><span class="p">(</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;explosion energy&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">problems/sedov.py:py_get_parms</span><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>    <span class="c1"># fetch out the parameters during initialize</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>    <span class="n">sedov</span> <span class="o">=</span> <span class="n">unit</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&quot;sedov&quot;</span><span class="p">)</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    <span class="n">radius</span> <span class="o">=</span> <span class="mf">3.5</span> <span class="o">*</span> <span class="n">dx</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    <span class="c1"># provide types to validate the expected types and provide static type checking</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    <span class="n">dens</span> <span class="o">=</span> <span class="n">sedov</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;density&quot;</span><span class="p">)</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">sedov</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;pressure&quot;</span><span class="p">)</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    <span class="n">E</span> <span class="o">=</span> <span class="n">sedov</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;energy&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">problems/sedov.py:py_set_param</span><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>    <span class="c1"># arbitrary python types can be added to our package Params</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">SedovData</span><span class="p">(</span><span class="n">rho_ambient</span><span class="o">=</span><span class="n">dens</span><span class="p">,</span> <span class="n">p_ambient</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">p_explosion</span><span class="o">=</span><span class="n">pres</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">)</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    <span class="n">unit</span><span class="o">.</span><span class="n">AddParam</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">problems/sedov.py:py_get_param</span><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>    <span class="n">pkg</span> <span class="o">=</span> <span class="n">mb</span><span class="o">.</span><span class="n">get_package</span><span class="p">(</span><span class="s2">&quot;sedov&quot;</span><span class="p">)</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>    <span class="c1"># Any python object can get pulled out of Params and validated for type</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">pkg</span><span class="o">.</span><span class="n">GetParam</span><span class="p">(</span><span class="n">SedovData</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span>
</code></pre></div>
<p>For complete examples of using UnitData and building simulations, see 
<a href="../simulation_setup/">Setting up a Simulation</a>.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.indexes"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>